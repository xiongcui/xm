{"version":3,"file":"packageMoka/pages/moka/editvideo/index.js","sources":["webpack:///./src/packageMoka/pages/moka/editvideo/index.vue?ee93","webpack:///index.vue","webpack:///./src/packageMoka/pages/moka/editvideo/index.vue?e35c","webpack:///._src_packageMoka_pages_moka_editvideo_index.scss","webpack:///._src_packageMoka_pages_moka_editvideo_index.vue","webpack:///./src/packageMoka/pages/moka/editvideo/index.vue?e487","webpack:///./src/packageMoka/pages/moka/editvideo/index.vue?c3fb"],"sourcesContent":["import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=8459d99c&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"8459d99c\",\n  \"77cbc000\"\n  \n)\n\ncomponent.options.__file = \"src/packageMoka/pages/moka/editvideo/index.vue\"\nexport default component.exports","<template>\n  <view class=\"editvideomain\">\n    <view class=\"editvideo\">\n      <block v-if=\"videoData.length\">\n        <view v-for=\"(item, index) in videoData\" :key=\"index\">\n          <video\n            class=\"video_item\"\n            objectFit=\"cover\"\n            :poster=\"item.cover\"\n            :src=\"item.file\"\n            :key=\"item.file\"\n          ></video>\n          <view class=\"item_bottom ub\" v-if=\"myself\">\n            <view class=\"setVideoLeft\">\n              <view @tap=\"deleteVideo(index)\" class=\"btn_set btn_delete\"\n                >删除</view\n              >\n              <view @tap=\"changeVideo(index)\" class=\"btn_set\">更换</view>\n            </view>\n            <view @tap=\"setVideoCover(index)\" class=\"btn_set\"\n              >设置视频封面</view\n            >\n          </view>\n        </view>\n      </block>\n      <view\n        @tap=\"chooesVideo\"\n        class=\"video_none\"\n        v-if=\"videoData.length < 6 && myself\"\n      >\n        <image\n          src=\"https://yuepai-oss.qubeitech.com/static/images/common/add_icon.png\"\n        ></image>\n        <view>添加形象视频</view>\n      </view>\n    </view>\n    <view catchtap=\"sub\" class=\"sub_btn\" v-if=\"videoData.length && myself\">\n      <button type=\"primary\" @tap=\"submit\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport \"./index.scss\";\nimport { Base64 } from \"js-Base64\";\nimport { openPage } from \"../../../../utils/util\";\nimport { userAlbum, userAlbumDetail } from \"../../../../api/index\";\nimport clickThrottle from \"../../../../utils/clickThrottle\";\nexport default {\n  name: \"editvideo\",\n  data() {\n    return {\n      videoData: [],\n      myself: true,\n    };\n  },\n  methods: {\n    deleteVideo(index) {\n      this.videoData.splice(index, 1);\n    },\n    setVideoCover(index) {\n      wx.chooseMedia({\n        count: 1,\n        mediaType: [\"image\"],\n        sourceType: [\"album\", \"camera\"],\n        maxDuration: 30,\n        camera: \"back\",\n        success(res) {\n          let arr = res.tempFiles.map((item) => {\n            return item.tempFilePath;\n          });\n          openPage(\n            \"/packageAdd/pages/user/we-cropper/index?type=videoId&videoId=\" +\n              index +\n              \"&imgSrc=\" +\n              arr[0]\n          );\n        },\n      });\n    },\n    changeVideo(index) {\n      let _this = this;\n      wx.chooseMedia({\n        count: 1,\n        mediaType: [\"video\"],\n        sourceType: [\"album\", \"camera\"],\n        maxDuration: 58,\n        camera: \"back\",\n        success: (res) => {\n          let arr = res.tempFiles;\n          let videoInfo = {};\n          arr.map(function (v, i) {\n            v[\"progress\"] = 0;\n            videoInfo = v;\n          });\n          console.log(videoInfo, \"videoInfo\");\n          //获取临时存放的视频资源\n          // let tempFilePath = res.tempFiles[0].tempFilePath;\n          //获取该视频的播放时间\n          let duration = res.tempFiles[0].duration;\n          console.log(\"视频播放时间为\" + duration);\n          //获取视频的大小(MB单位)\n          let size = parseFloat(res.tempFiles[0].size / 1024 / 1024).toFixed(1);\n          console.log(\"视频大小为\" + size);\n          //获取视频的高度\n          let height = res.tempFiles[0].height;\n          console.log(\"视频高度为\" + height);\n          //获取视频的宽度\n          let width = res.tempFiles[0].width;\n          console.log(\"视频宽度为\" + width);\n          //校验大小后，符合进行上传\n          if (size > 20) {\n            let beyongSize = size - 20; //获取视频超出限制大小的数量\n            wx.showToast({\n              title: \"上传的视频大小超限,超出\" + beyongSize + \"MB,请重新上传！\",\n              icon: \"none\",\n            });\n            return;\n          } else {\n            //符合大小限制，进行上传\n            _this.uploadVideo(videoInfo, index);\n          }\n        },\n      });\n    },\n    chooesVideo() {\n      let _this = this;\n      wx.chooseMedia({\n        count: 1,\n        mediaType: [\"video\"],\n        sourceType: [\"album\", \"camera\"],\n        maxDuration: 58,\n        camera: \"back\",\n        success: (res) => {\n          let arr = res.tempFiles;\n          let videoInfo = {};\n          arr.map(function (v, i) {\n            v[\"progress\"] = 0;\n            videoInfo = v;\n          });\n          console.log(videoInfo, \"videoInfo\");\n          //获取临时存放的视频资源\n          // let tempFilePath = res.tempFiles[0].tempFilePath;\n          //获取该视频的播放时间\n          let duration = res.tempFiles[0].duration;\n          console.log(\"视频播放时间为\" + duration);\n          //获取视频的大小(MB单位)\n          let size = parseFloat(res.tempFiles[0].size / 1024 / 1024).toFixed(1);\n          console.log(\"视频大小为\" + size);\n          //获取视频的高度\n          let height = res.tempFiles[0].height;\n          console.log(\"视频高度为\" + height);\n          //获取视频的宽度\n          let width = res.tempFiles[0].width;\n          console.log(\"视频宽度为\" + width);\n          //校验大小后，符合进行上传\n          if (size > 20) {\n            let beyongSize = size - 20; //获取视频超出限制大小的数量\n            wx.showToast({\n              title: \"上传的视频大小超限,超出\" + beyongSize + \"MB,请重新上传！\",\n              icon: \"none\",\n            });\n            return;\n          } else {\n            //符合大小限制，进行上传\n            _this.uploadVideo(videoInfo);\n          }\n        },\n      });\n    },\n    uploadVideo(dataInfo, index) {\n      let header = {};\n      let token = wx.getStorageSync(\"token\");\n      header[\"Authorization\"] = \"Basic \" + Base64.encode(token + \":\");\n      wx.showLoading({\n        title: \"上传中\",\n        mask: true,\n      });\n      wx.uploadFile({\n        url: \"https://pai.qubeitech.com/v1/file/upload\",\n        filePath: dataInfo.tempFilePath,\n        formData: {\n          scr_type: \"album\",\n        },\n        name: \"file\",\n        header,\n        success: (res) => {\n          wx.hideLoading();\n          //判断上传的是图片还是视频\n          let data = JSON.parse(res.data);\n          if (data.code == 200) {\n            if (index != undefined) {\n              console.log(\"更换\");\n              let oldVideoData = [];\n              this.videoData[index] = {\n                cover: \"\",\n                file: data.data.file1,\n              };\n              oldVideoData = this.videoData;\n              this.videoData = [];\n              this.videoData = JSON.parse(JSON.stringify(oldVideoData));\n            } else {\n              this.videoData.push({\n                cover: \"\",\n                file: data.data.file1,\n              });\n            }\n          } else {\n            wx.showToast({\n              title: \"上传失败！\",\n              icon: \"none\",\n            });\n          }\n        },\n      });\n    },\n    upCover(path, index) {\n      let header = {};\n      let token = wx.getStorageSync(\"token\");\n      header[\"Authorization\"] = \"Basic \" + Base64.encode(token + \":\");\n      wx.showLoading({\n        title: \"上传中\",\n        mask: true,\n      });\n      wx.uploadFile({\n        url: \"https://pai.qubeitech.com/v1/file/upload\",\n        filePath: path,\n        formData: {\n          scr_type: \"album\",\n        },\n        name: \"file\",\n        header,\n        success: (res) => {\n          wx.hideLoading();\n          //判断上传的是图片还是视频\n          let data = JSON.parse(res.data);\n          if (data.code == 200) {\n            this.videoData[index].cover = data.data.file1;\n          } else {\n            wx.showToast({\n              title: \"上传失败！\",\n              icon: \"none\",\n            });\n          }\n        },\n      });\n    },\n    submit() {\n      if (!clickThrottle()) return;\n      this.userAlbum({\n        scr_type: \"album\",\n        file_type: \"video\",\n        photo_album: [],\n        video_album: this.videoData,\n      });\n    },\n    async userAlbum(params) {\n      try {\n        let res = await userAlbum(params);\n        this.videoData = [];\n        wx.navigateBack({\n          delta: 1,\n        });\n      } catch (error) {}\n    },\n    async userAlbumDetail(params) {\n      try {\n        let res = await userAlbumDetail(params);\n        this.videoData = res.data.data.video_album;\n      } catch (error) {}\n    },\n  },\n  onShow() {\n    let pages = getCurrentPages();\n    let currPage = pages[pages.length - 1]; //当前页面\n    if (currPage.data.videoId) {\n      this.upCover(currPage.data.homeimg, Number(currPage.data.videoId));\n    }\n  },\n  onLoad: function (options) {\n    this.myself = options.myself === \"true\" ? true : false;\n    if (options.uuid) {\n      this.userAlbumDetail({\n        uuid: Number(options.uuid),\n      });\n    } else {\n      this.userAlbumDetail();\n    }\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"view\", { staticClass: \"editvideomain\" }, [\n    _c(\n      \"view\",\n      { staticClass: \"editvideo\" },\n      [\n        _vm.videoData.length\n          ? _c(\n              \"block\",\n              _vm._l(_vm.videoData, function (item, index) {\n                return _c(\"view\", { key: index }, [\n                  _c(\"video\", {\n                    key: item.file,\n                    staticClass: \"video_item\",\n                    attrs: {\n                      objectFit: \"cover\",\n                      poster: item.cover,\n                      src: item.file,\n                    },\n                  }),\n                  _vm.myself\n                    ? _c(\"view\", { staticClass: \"item_bottom ub\" }, [\n                        _c(\"view\", { staticClass: \"setVideoLeft\" }, [\n                          _c(\n                            \"view\",\n                            {\n                              staticClass: \"btn_set btn_delete\",\n                              on: {\n                                tap: function ($event) {\n                                  return _vm.deleteVideo(index)\n                                },\n                              },\n                            },\n                            [_vm._v(\"删除\")]\n                          ),\n                          _c(\n                            \"view\",\n                            {\n                              staticClass: \"btn_set\",\n                              on: {\n                                tap: function ($event) {\n                                  return _vm.changeVideo(index)\n                                },\n                              },\n                            },\n                            [_vm._v(\"更换\")]\n                          ),\n                        ]),\n                        _c(\n                          \"view\",\n                          {\n                            staticClass: \"btn_set\",\n                            on: {\n                              tap: function ($event) {\n                                return _vm.setVideoCover(index)\n                              },\n                            },\n                          },\n                          [_vm._v(\"设置视频封面\")]\n                        ),\n                      ])\n                    : _vm._e(),\n                ])\n              }),\n              0\n            )\n          : _vm._e(),\n        _vm.videoData.length < 6 && _vm.myself\n          ? _c(\n              \"view\",\n              { staticClass: \"video_none\", on: { tap: _vm.chooesVideo } },\n              [\n                _c(\"image\", {\n                  attrs: {\n                    src: \"https://yuepai-oss.qubeitech.com/static/images/common/add_icon.png\",\n                  },\n                }),\n                _c(\"view\", [_vm._v(\"添加形象视频\")]),\n              ]\n            )\n          : _vm._e(),\n      ],\n      1\n    ),\n    _vm.videoData.length && _vm.myself\n      ? _c(\"view\", { staticClass: \"sub_btn\", attrs: { catchtap: \"sub\" } }, [\n          _c(\n            \"button\",\n            { attrs: { type: \"primary\" }, on: { tap: _vm.submit } },\n            [_vm._v(\"保存\")]\n          ),\n        ])\n      : _vm._e(),\n  ])\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../../node_modules/@tarojs/taro-loader/lib/raw.js!./index.vue\"\nvar config = {\"navigationBarTitleText\":\"视频相册\",\"usingComponents\":{}};\n\n\nvar inst = Page(createPageConfig(component, 'packageMoka/pages/moka/editvideo/index', {root:{cn:[]}}, config || {}))\n\n\n","import mod from \"-!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=template&id=8459d99c&scoped=true&\""],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AAhBA;AAkBA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAxCA;AA0CA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AAxCA;AA0CA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AAnCA;AAqCA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AApBA;AAsBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AADA;AAJA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAtNA;AAwNA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AADA;AAGA;AACA;AACA;AACA;AAhPA;;;;;;;;;;;;;AChDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACpGA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;;;;;A","sourceRoot":""}