{"version":3,"file":"packageMoka/pages/moka/editpersonimg/index.js","sources":["webpack:///./src/packageMoka/pages/moka/editpersonimg/index.vue?7ee1","webpack:///index.vue","webpack:///./src/packageMoka/pages/moka/editpersonimg/index.vue?4efc","webpack:///._src_packageMoka_pages_moka_editpersonimg_index.scss","webpack:///._src_packageMoka_pages_moka_editpersonimg_index.vue","webpack:///./src/packageMoka/pages/moka/editpersonimg/index.vue?2fed","webpack:///./src/packageMoka/pages/moka/editpersonimg/index.vue?906e"],"sourcesContent":["import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=7e5d7576&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nfunction injectStyles (context) {\n  \n  \n}\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  injectStyles,\n  \"7e5d7576\",\n  \"41eadb13\"\n  \n)\n\ncomponent.options.__file = \"src/packageMoka/pages/moka/editpersonimg/index.vue\"\nexport default component.exports","<template>\n  <view class=\"editpersonimg\">\n    <view class=\"personimgs ub\">\n      <view class=\"side_gap\"></view>\n      <view class=\"ub-f1\">\n        <view class=\"imgsblock\">\n          <view class=\"imgs\">\n            <view class=\"preview_img\" v-for=\"(item, index) in imgs\" :key=\"item\">\n              <image\n                :id=\"index\"\n                :markImgindex=\"index\"\n                mode=\"widthFix\"\n                :src=\"item\"\n              ></image>\n              <view\n                @tap=\"delete_preview(index)\"\n                class=\"preview_delet\"\n                :id=\"index\"\n                >编辑</view\n              >\n              <view class=\"icon_coverimg\" v-if=\"index == 0\"> 封面 </view>\n            </view>\n            <view\n              @tap=\"choosePersonImg\"\n              class=\"pick_img\"\n              v-if=\"imgs.length < 9\"\n            >\n              <view class=\"pick_img_btn\">\n                <image\n                  src=\"../../../../assets/images/common/add_icon.png\"\n                ></image>\n              </view>\n              <view class=\"upload-text\">\n                <view>添加形象照</view>\n              </view>\n            </view>\n          </view>\n        </view>\n        <view style=\"clear: both\"></view>\n      </view>\n      <view class=\"side_gap_right\"></view>\n    </view>\n    <view class=\"sub_btn\">\n      <button @tap=\"submit\" type=\"primary\">保存</button>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { errortip, openPage } from \"../../../../utils/util\";\nimport {\n  userAlbum,\n  uploadImagePhoto,\n  userAlbumDetail,\n} from \"../../../../api/index\";\nimport \"./index.scss\";\nexport default {\n  name: \"editpersonimg\",\n  data() {\n    return {\n      imgs: [],\n      uploadImgList: [],\n    };\n  },\n  methods: {\n    choosePersonImg() {\n      if (this.imgs.length >= 9) {\n        wx.showToast({\n          title: \"最多上传9张图！\",\n          icon: \"none\",\n        });\n        return false;\n      }\n      wx.chooseMedia({\n        count: 9 - this.imgs.length,\n        mediaType: [\"image\"],\n        sourceType: [\"album\", \"camera\"],\n        maxDuration: 30,\n        camera: \"back\",\n        success(res) {\n          let arr = res.tempFiles.map((item) => {\n            return item.tempFilePath;\n          });\n          wx.setStorageSync(\"imgList\", arr);\n          openPage(\"/pages/we-cropper/index?type=imgList\");\n        },\n      });\n    },\n    delete_preview(index) {\n      let _this = this;\n      wx.showActionSheet({\n        itemList: [\"设为封面\", \"替换\", \"删除\"],\n        success(res) {\n          switch (res.tapIndex) {\n            case 0:\n              let first = _this.imgs[index];\n              _this.imgs.splice(index, 1);\n              _this.imgs.unshift(first);\n              break;\n            case 1:\n              wx.chooseMedia({\n                count: 1,\n                mediaType: [\"image\"],\n                sourceType: [\"album\", \"camera\"],\n                maxDuration: 30,\n                camera: \"back\",\n                success(res) {\n                  let arr = res.tempFiles.map((item) => {\n                    return item.tempFilePath;\n                  });\n                  openPage(\n                    \"/pages/we-cropper/index?type=imgId&imgId=\" +\n                      index +\n                      \"&imgSrc=\" +\n                      arr[0]\n                  );\n                },\n              });\n              break;\n            case 2:\n              _this.imgs.splice(index, 1);\n              break;\n          }\n        },\n        fail(res) {\n          console.log(res.errMsg);\n        },\n      });\n    },\n    submit() {\n      if (this.imgs.length < 3) {\n        errortip(\"形象照不能少于3张哦\");\n        return;\n      }\n      let arr = [];\n      this.imgs.map((item, index) => {\n        console.log(item.indexOf(\"https:\") < 0);\n        if (item.indexOf(\"https:\") < 0) {\n          // if (item.indexOf(\"http:\") != -1 || item.indexOf(\"wxfile://\" != -1)) {\n          arr[index] = this.uploadImagePhoto(\n            item,\n            {\n              scr_type: \"album\",\n            },\n            index\n          );\n        }\n      });\n      Promise.all(arr)\n        .then(() => {\n          this.userAlbum({\n            scr_type: \"album\",\n            file_type: \"photo\",\n            photo_album: this.imgs,\n            video_album: [],\n          });\n        })\n        .catch(() => {\n          wx.showToast({\n            title: \"有图片上传失败！\",\n            icon: \"none\",\n          });\n          this.imgs = this.uploadImgList;\n        });\n    },\n    async userAlbum(params) {\n      try {\n        let res = await userAlbum(params);\n        this.uploadImgList = [];\n        wx.navigateBack({\n          delta: 1,\n        });\n      } catch (error) {}\n    },\n    async uploadImagePhoto(path, params, index) {\n      try {\n        let res = await uploadImagePhoto(path, params);\n        this.imgs[index] = res.data.file1;\n      } catch (error) {}\n    },\n    async userAlbumDetail(params) {\n      try {\n        let res = await userAlbumDetail(params);\n        this.imgs = res.data.data.photo_album;\n      } catch (error) {}\n    },\n  },\n  created() {\n    this.userAlbumDetail();\n  },\n  onShow() {\n    let pages = getCurrentPages();\n    let currPage = pages[pages.length - 1]; //当前页面\n    if (currPage.data.updateimg) {\n      this.imgs = this.imgs.concat(this.globalData.imgList);\n      this.globalData.imgList = [];\n    }\n    if (currPage.data.imgId) {\n      this.imgs[Number(currPage.data.imgId)] = currPage.data.homeimg;\n      this.imgs = JSON.parse(JSON.stringify(this.imgs));\n    }\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","var render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\"view\", { staticClass: \"editpersonimg\" }, [\n    _c(\"view\", { staticClass: \"personimgs ub\" }, [\n      _c(\"view\", { staticClass: \"side_gap\" }),\n      _c(\"view\", { staticClass: \"ub-f1\" }, [\n        _c(\"view\", { staticClass: \"imgsblock\" }, [\n          _c(\n            \"view\",\n            { staticClass: \"imgs\" },\n            [\n              _vm._l(_vm.imgs, function (item, index) {\n                return _c(\"view\", { key: item, staticClass: \"preview_img\" }, [\n                  _c(\"image\", {\n                    attrs: {\n                      id: index,\n                      markImgindex: index,\n                      mode: \"widthFix\",\n                      src: item,\n                    },\n                  }),\n                  _c(\n                    \"view\",\n                    {\n                      staticClass: \"preview_delet\",\n                      attrs: { id: index },\n                      on: {\n                        tap: function ($event) {\n                          return _vm.delete_preview(index)\n                        },\n                      },\n                    },\n                    [_vm._v(\"编辑\")]\n                  ),\n                  index == 0\n                    ? _c(\"view\", { staticClass: \"icon_coverimg\" }, [\n                        _vm._v(\" 封面 \"),\n                      ])\n                    : _vm._e(),\n                ])\n              }),\n              _vm.imgs.length < 9\n                ? _c(\n                    \"view\",\n                    {\n                      staticClass: \"pick_img\",\n                      on: { tap: _vm.choosePersonImg },\n                    },\n                    [\n                      _c(\"view\", { staticClass: \"pick_img_btn\" }, [\n                        _c(\"image\", {\n                          attrs: {\n                            src: require(\"../../../../assets/images/common/add_icon.png\"),\n                          },\n                        }),\n                      ]),\n                      _c(\"view\", { staticClass: \"upload-text\" }, [\n                        _c(\"view\", [_vm._v(\"添加形象照\")]),\n                      ]),\n                    ]\n                  )\n                : _vm._e(),\n            ],\n            2\n          ),\n        ]),\n        _c(\"view\", { staticStyle: { clear: \"both\" } }),\n      ]),\n      _c(\"view\", { staticClass: \"side_gap_right\" }),\n    ]),\n    _c(\"view\", { staticClass: \"sub_btn\" }, [\n      _c(\"button\", { attrs: { type: \"primary\" }, on: { tap: _vm.submit } }, [\n        _vm._v(\"保存\"),\n      ]),\n    ]),\n  ])\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }","// extracted by mini-css-extract-plugin","import { createPageConfig } from '@tarojs/runtime'\nimport component from \"../../../../../node_modules/@tarojs/taro-loader/lib/raw.js!./index.vue\"\nvar config = {\"navigationBarTitleText\":\"照片相册\",\"usingComponents\":{}};\n\n\nvar inst = Page(createPageConfig(component, 'packageMoka/pages/moka/editpersonimg/index', {root:{cn:[]}}, config || {}))\n\n\n","import mod from \"-!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/babel-loader/lib/index.js!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=template&id=7e5d7576&scoped=true&\""],"mappings":";;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC2BA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAcA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA;AAhBA;AAkBA;AACA;AAAA;AACA;AACA;AAAA;AA5BA;AA8BA;AACA;AACA;AACA;AApCA;AAsCA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAGA;AADA;AAKA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAEA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AACA;AACA;AADA;AAJA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAHA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAzHA;AA2HA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAjJA;;;;;;;;;;;;;ACxDA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjFA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACPA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;;;;;A","sourceRoot":""}